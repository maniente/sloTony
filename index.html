<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>SloTony</title>
  <style>
    body {
      font-family: Sans-Serif;
      margin: 0;
      color: white;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      overflow: hidden;
      background-image: url('img/grifone.png'); /* Set your background image */
      background-size: cover;
      background-position: center;
      position: relative;
    }

    /* Slots container */
    .slots {
      text-align: center;
      display: flex;
      justify-content: space-between;
      width: 100%;
      max-width: 400px;
      padding: 20px;
      border-radius: 10px;
    }

    /* Slot wheels with green background and yellow 3D effect border */
    .reel {
      display: inline-block;
      width: 80px;
      height: 200px;
      margin: 10px;
      background-color: green; /* Green background inside the wheel */
      border-radius: 10px;
      background-size: 100% 79px;
      background-position: 0 0;
      transition: background-position-y 0.5s cubic-bezier(0.4, 0.0, 0.2, 1);

      /* Yellow 3D border effect */
      border: 3px solid yellow;
      box-shadow: 0px 4px 10px rgba(255, 255, 0, 0.6), 
                  inset 0px 4px 10px rgba(255, 255, 0, 0.6); /* 3D shadow effect */
    }

    /* Button with 3D effect */
    .button {
      display: inline-block;
      margin-top: 20px;
      padding: 10px 20px;
      background-color: green;
      color: white;
      border: none;
      border-radius: 5px;
      font-size: 1.2rem;
      cursor: pointer;
      transition: background-color 0.3s ease, box-shadow 0.2s ease;
      box-shadow: 0px 4px 0px #004d00; /* 3D effect */
    }

    /* Button press effect (yellow) */
    .button:active {
      background-color: yellow;
      color: black;
      box-shadow: 0px 2px 0px #b5b500; /* Pressed down 3D effect */
      transform: translateY(2px); /* Button pressed down */
    }

    /* Coin balance container (styled like the reels) */
    .balance {
      position: absolute;
      top: 20px;
      right: 20px;
      background-color: green;
      border: 3px solid yellow;
      box-shadow: 0px 4px 10px rgba(255, 255, 0, 0.6), 
                  inset 0px 4px 10px rgba(255, 255, 0, 0.6); /* 3D shadow effect */
      padding: 10px;
      border-radius: 10px;
      text-align: center;
      color: white;
      font-size: 1.2rem;
      width: 150px;
    }

    .balance div {
      margin: 5px 0;
    }

    @media (max-width: 500px) {
      .reel {
        width: 70px;
        height: 150px;
      }

      .button {
        font-size: 1rem;
      }

      .balance {
        width: 120px;
        font-size: 1rem;
      }
    }
  </style>
</head>
<body>

  <div class="slots">
    <div class="reel"></div>
    <div class="reel"></div>
    <div class="reel"></div>
    <div class="reel"></div> 
  </div>
  
  <!-- Coin balance styled like the reels -->
  <div class="balance">
    <div>Coins: <span id="coins">10</span></div>
    <div>Wins: <span id="wins">0</span></div>
  </div>
  
  <div style="text-align:center;">
    <button class="button" id="spinButton">Spin</button>
  </div>

  <script>
    const coinsEl = document.getElementById('coins'),
          winsEl = document.getElementById('wins'),
          iconMap = [
            "url('img/image1.png')",
            "url('img/image2.png')",
            "url('img/image3.png')",
            "url('img/image4.png')",
            "url('img/image5.png')"
          ],
          icon_width = 79, 
          icon_height = 79, 
          num_icons = 5, /* Now only 5 symbols */
          time_per_icon = 100,
          indexes = [0, 0, 0, 0];

    let coins = 10, // Starting number of coins
        wins = 0;   // Starting number of wins

    // Function to handle rolling the reels
    const roll = (reel, offset = 0, reelIndex = 0) => {
      const delta = (offset + 2) * num_icons + Math.round(Math.random() * num_icons); 
      return new Promise((resolve) => {
        const style = getComputedStyle(reel),
              backgroundPositionY = parseFloat(style["background-position-y"]),
              targetBackgroundPositionY = backgroundPositionY + delta * icon_height,
              normTargetBackgroundPositionY = targetBackgroundPositionY % (num_icons * icon_height);

        // Randomly assign a different background image from iconMap for each reel
        reel.style.backgroundImage = iconMap[reelIndex % num_icons];

        requestAnimationFrame(() => {
          reel.style.transition = `background-position-y ${(8 + 1 * delta) * time_per_icon}ms cubic-bezier(0.4, 0.0, 0.2, 1)`;
          reel.style.backgroundPositionY = `${backgroundPositionY + delta * icon_height}px`;
        });

        setTimeout(() => {
          reel.style.transition = 'none'; 
          reel.style.backgroundPositionY = `${normTargetBackgroundPositionY}px`;
          resolve(delta % num_icons);
        }, (8 + 1 * delta) * time_per_icon);
      });
    };

    // Function to check winning combinations
    const checkForWin = (indexes) => {
      if (indexes[0] === indexes[1] && indexes[1] === indexes[2] && indexes[2] === indexes[3]) {
        return 5; // Jackpot: All symbols match
      } else if (indexes[0] === indexes[1] || indexes[1] === indexes[2] || indexes[2] === indexes[3]) {
        return 2; // Win for any two adjacent matching symbols
      }
      return 0; // No win
    };

    // Function to handle the spinning of all reels
    function rollAll() {
      if (coins <= 0) {
        alert('You have no coins left!');
        return;
      }
      
      coins--; // Deduct one coin for each spin
      coinsEl.textContent = coins;

      const reelsList = document.querySelectorAll('.slots > .reel');
      
      Promise
        .all([...reelsList].map((reel, i) => roll(reel, i, i))) 
        .then((deltas) => {
          deltas.forEach((delta, i) => indexes[i] = (indexes[i] + delta) % num_icons);

          reelsList.forEach((reel, i) => {
            reel.style.backgroundImage = iconMap[indexes[i]]; // Display the final symbol after spinning
          });

          const winCoins = checkForWin(indexes);
          if (winCoins > 0) {
            wins += winCoins;
            coins += winCoins; // Add the winning coins to the total coins
            alert(`You won ${winCoins} coins!`);
            coinsEl.textContent = coins;
            winsEl.textContent = wins;
          }
        });
    }

    document.getElementById('spinButton').addEventListener('click', rollAll);
  </script>
</body>
</html>
